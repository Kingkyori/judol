"use strict";exports.id=529,exports.ids=[529],exports.modules={1529:(e,t,r)=>{r.r(t),r.d(t,{clone:()=>I,createClient:()=>R,digest:()=>_,get:()=>D,getAll:()=>T,has:()=>U,parseConnectionString:()=>h,setTracerProvider:()=>c});var n,s=r(3977),a="@vercel/edge-config",o="1.2.0",i=Symbol.for("@vercel/edge-config:global-trace");function c(e){Reflect.set(globalThis,i,e)}function u(e,t={name:e.name}){return function(...r){let n=function(){let e=Reflect.get(globalThis,i);return null==e?void 0:e.getTracer(a,o)}();return n&&("true"===process.env.EDGE_CONFIG_TRACE_VERBOSE||!1===t.isVerboseTrace)?n.startActiveSpan(t.name,n=>{t.attributes&&n.setAttributes(t.attributes);try{let s=e.apply(this,r);return null!==s&&"object"==typeof s&&"then"in s&&"function"==typeof s.then?s.then(e=>{t.attributesSuccess&&n.setAttributes(t.attributesSuccess(e)),n.setStatus({code:1}),n.end()}).catch(e=>{t.attributesError&&n.setAttributes(t.attributesError(e)),n.setStatus({code:2,message:e instanceof Error?e.message:void 0}),n.end()}):(t.attributesSuccess&&n.setAttributes(t.attributesSuccess(s)),n.setStatus({code:1}),n.end()),s}catch(e){throw t.attributesError&&n.setAttributes(t.attributesError(e)),n.setStatus({code:2,message:e instanceof Error?e.message:void 0}),n.end(),e}}):e.apply(this,r)}}var l={UNAUTHORIZED:"@vercel/edge-config: Unauthorized",EDGE_CONFIG_NOT_FOUND:"@vercel/edge-config: Edge Config not found"},f=class extends Error{constructor(e){super(`@vercel/edge-config: Unexpected error due to response with status code ${e.status}`)}};function d(e){if("string"!=typeof e)throw Error("@vercel/edge-config: Expected key to be a string")}function g(e){if(!Array.isArray(e)||e.some(e=>"string"!=typeof e))throw Error("@vercel/edge-config: Expected keys to be an array of string")}function h(e){return function(e){try{let t=new URL(e);if("edge-config.vercel.com"!==t.host||"https:"!==t.protocol||!t.pathname.startsWith("/ecfg"))return null;let r=t.pathname.split("/")[1];if(!r)return null;let n=t.searchParams.get("token");if(!n||""===n)return null;return{type:"vercel",baseUrl:`https://edge-config.vercel.com/${r}`,id:r,version:"1",token:n}}catch{return null}}(e)||function(e){try{let t=new URL(e),r=t.searchParams.get("id"),n=t.searchParams.get("token"),s=t.searchParams.get("version")||"1";if((!r||t.pathname.startsWith("/ecfg_"))&&(r=t.pathname.split("/")[1]||null),!r||!n)return null;return t.search="",{type:"external",baseUrl:t.toString(),id:r,token:n,version:s}}catch{return null}}(e)}function p(e){return new Response(e.response,{headers:{...e.headers,Age:String(Math.max(1,Math.floor((Date.now()-e.time)/1e3)))},status:e.status})}u(function(e){return"function"==typeof structuredClone?structuredClone(e):void 0===e?e:JSON.parse(JSON.stringify(e))},{name:"clone"});var m=new Map,v=u(async function(e,t={}){let{headers:r=new Headers,...n}=t,s=r.get("Authorization"),a=`${e},${s||""}`,o=m.get(a);if(o){let{etag:t,response:s}=o,i=new Headers(r);i.set("If-None-Match",t);let c=function(e){if(!e)return null;let t=/stale-if-error=(?<staleIfError>\d+)/i.exec(e);return(null==t?void 0:t.groups)?Number(t.groups.staleIfError):null}(i.get("Cache-Control")),u=await fetch(e,{...n,headers:i}).then(function(e){switch(e.status){case 500:case 502:case 503:case 504:return"number"==typeof c&&o.time<Date.now()+1e3*c?p(o):e;default:return e}},function(e){if("number"==typeof c&&o.time<Date.now()+1e3*c)return p(o);throw e});if(304===u.status)return u.cachedResponseBody=JSON.parse(s),u;let l=u.headers.get("ETag");return u.ok&&l&&m.set(a,{etag:l,response:await u.clone().text(),headers:Object.fromEntries(u.headers.entries()),status:u.status,time:Date.now()}),u}let i=await fetch(e,t),c=i.headers.get("ETag");return i.ok&&c&&m.set(a,{etag:c,response:await i.clone().text(),headers:Object.fromEntries(i.headers.entries()),status:i.status,time:Date.now()}),i},{name:"fetchWithCachedResponse",attributesSuccess:e=>({status:e.status})}),w=new Map,y=u(s.readFile,{name:"readFile"}),E=u(JSON.parse,{name:"JSON.parse"}),b=Symbol.for("privateEdgeConfig"),N=u((e,t)=>{let r=w.get(e);if(r)return r;let n=E(t);return w.set(e,Object.freeze(n)),n},{name:"cached JSON.parse"}),O=u(async function(e){if("vercel"!==e.type||!process.env.AWS_LAMBDA_FUNCTION_NAME)return null;try{let t=await y(`/opt/edge-config/${e.id}.json`,"utf-8");return N(e.id,t)}catch{return null}},{name:"getFileSystemEdgeConfig"}),A=u(async function(e){let t=Reflect.get(globalThis,b);return"object"==typeof t&&"function"==typeof t.get?t.get(e.id):null},{name:"getPrivateEdgeConfig"});async function S(e){return await A(e)||await O(e)}async function C(e){await e.arrayBuffer()}var R=u(function(e,t={staleIfError:604800,cache:"no-store"}){var r;let n,s;if(!e)throw Error("@vercel/edge-config: No connection string provided");let i=h(e);if(!i)throw Error("@vercel/edge-config: Invalid connection string provided");let c=i.id,p=i.baseUrl,m=i.version,w={Authorization:`Bearer ${i.token}`};"undefined"!=typeof process&&process.env.VERCEL_ENV&&(w["x-edge-config-vercel-env"]=process.env.VERCEL_ENV),"string"==typeof a&&"string"==typeof o&&(w["x-edge-config-sdk"]=`${a}@${o}`),"number"==typeof t.staleIfError&&t.staleIfError>0&&(w["cache-control"]=`stale-if-error=${t.staleIfError}`);let y=t.cache||"no-store",E=(r=!t.disableDevelopmentCache&&!1,n=null,s=null,u(()=>r?(s||(s=v(`${i.baseUrl}/items?version=${i.version}`,{headers:new Headers(w),cache:y}).then(async e=>{let t;let r=e.headers.get("x-edge-config-digest");if(e.ok)t=await e.json();else if(await C(e),!(t=e.cachedResponseBody))return null;return{digest:r,items:t}})).then(e=>{n=Promise.resolve(e),s=null},()=>{n=null,s=null}),n||(n=s),n):Promise.resolve(null),{name:"getInMemoryEdgeConfig"}));return{get:u(async function(e){let t=await E()||await S(i);return t?(d(e),Promise.resolve(t.items[e])):(d(e),v(`${p}/item/${e}?version=${m}`,{headers:new Headers(w),cache:y}).then(async e=>{if(e.ok)return e.json();if(await C(e),401===e.status)throw Error(l.UNAUTHORIZED);if(404===e.status){if(e.headers.has("x-edge-config-digest"))return;throw Error(l.EDGE_CONFIG_NOT_FOUND)}if(void 0!==e.cachedResponseBody)return e.cachedResponseBody;throw new f(e)}))},{name:"get",isVerboseTrace:!1,attributes:{edgeConfigId:c}}),has:u(async function(e){let t=await E()||await S(i);if(t){var r;return d(e),Promise.resolve((r=t.items,Object.prototype.hasOwnProperty.call(r,e)))}return d(e),fetch(`${p}/item/${e}?version=${m}`,{method:"HEAD",headers:new Headers(w),cache:y}).then(e=>{if(401===e.status)throw Error(l.UNAUTHORIZED);if(404===e.status){if(e.headers.has("x-edge-config-digest"))return!1;throw Error(l.EDGE_CONFIG_NOT_FOUND)}if(e.ok)return!0;throw new f(e)})},{name:"has",isVerboseTrace:!1,attributes:{edgeConfigId:c}}),getAll:u(async function(e){let t=await E()||await S(i);if(t)return void 0===e?Promise.resolve(t.items):(g(e),Promise.resolve(function(e,t){let r={};return t.forEach(t=>{r[t]=e[t]}),r}(t.items,e)));Array.isArray(e)&&g(e);let r=Array.isArray(e)?new URLSearchParams(e.map(e=>["key",e])).toString():null;return""===r?Promise.resolve({}):v(`${p}/items?version=${m}${null===r?"":`&${r}`}`,{headers:new Headers(w),cache:y}).then(async e=>{if(e.ok)return e.json();if(await C(e),401===e.status)throw Error(l.UNAUTHORIZED);if(404===e.status)throw Error(l.EDGE_CONFIG_NOT_FOUND);if(void 0!==e.cachedResponseBody)return e.cachedResponseBody;throw new f(e)})},{name:"getAll",isVerboseTrace:!1,attributes:{edgeConfigId:c}}),digest:u(async function(){let e=await E()||await S(i);return e?Promise.resolve(e.digest):v(`${p}/digest?version=${m}`,{headers:new Headers(w),cache:y}).then(async e=>{if(e.ok)return e.json();if(await C(e),void 0!==e.cachedResponseBody)return e.cachedResponseBody;throw new f(e)})},{name:"digest",isVerboseTrace:!1,attributes:{edgeConfigId:c}}),connection:i}},{name:"createClient"});function $(){n||(n=R(process.env.EDGE_CONFIG))}var D=(...e)=>($(),n.get(...e)),T=(...e)=>($(),n.getAll(...e)),U=(...e)=>($(),n.has(...e)),_=(...e)=>($(),n.digest(...e));function I(e){return JSON.parse(JSON.stringify(e))}}};